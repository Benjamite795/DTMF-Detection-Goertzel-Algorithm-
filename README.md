#Introduction
This project provides a Dual Tone Multi Frequency (DTMF) detection system developed on AVR Atmega128 board based on Goertzel algorithm. 


#Background
DTMF was originally developed to be used for dial tone representation for control signals to be transmitted over the telephone network. In addition to telephone calls set up, DTMF allows user input during a call which allows interactive applications such as telephone banking, electronic mail systems, conference calls or similar applications.

In DTMF, each digit is generated by two superimposed tones (or sinusoidal signals) selected from two frequency groups providing 16 unique keys as shown in the figure below:

![DTMF digits representation](https://github.com/OmaymaS/DTMF-Detection-Goertzel-Algorithm-/blob/master/Images/DTMF1.png)

This implementation provides unique characteristics for the system such as:

* All tones are in the audible frequency range.

* No frequency in both frequency groups is a multiple of another one.

* The sum or difference of any two frequencies does not equal another selected frequency.


Such features simplify DTMF decoding where the eight DTMF frequencies should be differentiated in order to detect valid DTMF tones and distinguish them from speech. A series of checks are always carried out at the receiver side in order to detect the tones and validate them based on the criteria of the used standard. The common algorithm used for DTMF detection is Goertzel algorithm which is similar to FFT but faster.

#System Analysis

##ADC Settings

The required system should be able to acquire data from an external source (which is a standalone program in our case) and use the ADC in order to get the samples to be used in calculations for DTMF detection. The given AVR board includes an ADC which can run either in a single-conversion mode or a free-running mode. In the free running mode the ADC is constantly sampling and updating the ADC Data Register. The samples are taken at the maximum speed and the interrupts can be used for reading results. The timing diagram shows the conversion cycles and the following settings should be used to use free-running mode at 125 KHz with interrupts:

  * ADEN = 1	Enable ADC
  
  * ADSC = 1	Start continuous conversion 
  
  * ADIF	
      * Set when an ADC conversion completes and the data registers are updated
      * cleared by hardware when executing the corresponding interrupt handling vector
      
  * ADFR = 1	Enable free running mode
  
  * ADIE = 1	Enable ADC interrupt 
  
  * ADPS2:0 = 111	ADC pre-scaler select bits (division factor 128)

![ADCSRA](https://github.com/OmaymaS/DTMF-Detection-Goertzel-Algorithm-/blob/master/Images/ADCSRA.png)

![ADMUX](https://github.com/OmaymaS/DTMF-Detection-Goertzel-Algorithm-/blob/master/Images/ADMUX.png)

![Timing Diagram](https://github.com/OmaymaS/DTMF-Detection-Goertzel-Algorithm-/blob/master/Images/Timing%20Diagram.png)

##Calculations and parameters selection

The telephone network operates within a bandwidth of approx. 300 to 3400 Hz which is suitable for voice communications. The sampling frequency of telephone systems is usually 8 KHz. However, in our system the internal ADC of the AVR board is used with different sampling rate according to the selected division factor. The block size N can be arbitrarily selected considering the balance between accuracy and detection time. The different standards suggest certain values to be used in the telephone systems. For our application we will select different values and test the results.

	* According to the selected division factor (128), the ADC clock is at 125 KHz. And according to timing diagram, the conversion time is 13 cycles.
	* The sampling frequency equals (125 KHz)/(13 Cycles)=9615.38 sample/sec and the sampling time is 0.104 ms 
	* For our system the selected value of N=96. Accordingly, the frequency resolution (or main lobe width) is determined
by fs/N=100. 
 * The time required to receive N samples equals 96*0.104ms=9.98 ms.


